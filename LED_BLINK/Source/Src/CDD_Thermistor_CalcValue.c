/*
 * CDD_Thermistor_CalcValue.c
 *
 *  Created on: Jul 14, 2023
 *      Author: romag
 */
#include "CDD_Thermistor_CalcValue.h"

#define VREFANALOG_VOLTAGE		(3300u)
#define RESISTENCE_VALUE		(10000u) //Resistence 10k
#define RESOLUTION_SCALE		(1000000u)


#define ROWS		(220u)
#define COLUMNS     (2u)

uint32_t u32ResistanceOfSensor;
uint16_t u16VoltageOfSensor;
uint16_t u16IndexForARRAY;
uint16_t u16TemperatureOnTheSensor = 0u;

uint32_t u16TabelsOfGrades[ROWS][COLUMNS] =
{
		{	-10000	,	25067	},	//	-10,00
		{	-9500	,	24583	},	//	-9,50
		{	-9000	,	24110	},	//	-9,00
		{	-8500	,	23648	},	//	-8,50
		{	-8000	,	23197	},	//	-8,00
		{	-7500	,	22755	},	//	-7,50
		{	-7000	,	22324	},	//	-7,00
		{	-6500	,	21903	},	//	-6,50
		{	-6000	,	21491	},	//	-6,00
		{	-5500	,	21088	},	//	-5,50
		{	-5000	,	20695	},	//	-5,00
		{	-4500	,	20310	},	//	-4,50
		{	-4000	,	19933	},	//	-4,00
		{	-3500	,	19565	},	//	-3,50
		{	-3000	,	19206	},	//	-3,00
		{	-2500	,	18854	},	//	-2,50
		{	-2000	,	18509	},	//	-2,00
		{	-1500	,	18173	},	//	-1,50
		{	-1000	,	17843	},	//	-1,00
		{	-500	,	17521	},	//	-0,50
		{	0	    ,	17206	},	//	0,00
		{	500		,	16897	},	//	0,50
		{	1000	,	16595	},	//	1,00
		{	1500	,	16300	},	//	1,50
		{	2000	,	16011	},	//	2,00
		{	2500	,	15728	},	//	2,50
		{	3000	,	15451	},	//	3,00
		{	3500	,	15180	},	//	3,50
		{	4000	,	14914	},	//	4,00
		{	4500	,	14654	},	//	4,50
		{	5000	,	14400	},	//	5,00
		{	5500	,	14151	},	//	5,50
		{	6000	,	13907	},	//	6,00
		{	6500	,	13668	},	//	6,50
		{	7000	,	13434	},	//	7,00
		{	7500	,	13205	},	//	7,50
		{	8000	,	12981	},	//	8,00
		{	8500	,	12761	},	//	8,50
		{	9000	,	12546	},	//	9,00
		{	9500	,	12335	},	//	9,50
		{	10000	,	12128	},	//	10,00
		{	10500	,	11925	},	//	10,50
		{	11000	,	11727	},	//	11,00
		{	11500	,	11532	},	//	11,50
		{	12000	,	11342	},	//	12,00
		{	12500	,	11155	},	//	12,50
		{	13000	,	10972	},	//	13,00
		{	13500	,	10793	},	//	13,50
		{	14000	,	10617	},	//	14,00
		{	14500	,	10444	},	//	14,50
		{	15000	,	10275	},	//	15,00
		{	15500	,	10110	},	//	15,50
		{	16000	,	9947	},	//	16,00
		{	16500	,	9788	},	//	16,50
		{	17000	,	9632	},	//	17,00
		{	17500	,	9478	},	//	17,50
		{	18000	,	9328	},	//	18,00
		{	18500	,	9181	},	//	18,50
		{	19000	,	9036	},	//	19,00
		{	19500	,	8894	},	//	19,50
		{	20000	,	8755	},	//	20,00
		{	20500	,	8619	},	//	20,50
		{	21000	,	8485	},	//	21,00
		{	21500	,	8353	},	//	21,50
		{	22000	,	8224	},	//	22,00
		{	22500	,	8098	},	//	22,50
		{	23000	,	7974	},	//	23,00
		{	23500	,	7852	},	//	23,50
		{	24000	,	7733	},	//	24,00
		{	24500	,	7615	},	//	24,50
		{	25000	,	7500	},	//	25,00
		{	25500	,	7387	},	//	25,50
		{	26000	,	7276	},	//	26,00
		{	26500	,	7167	},	//	26,50
		{	27000	,	7060	},	//	27,00
		{	27500	,	6955	},	//	27,50
		{	28000	,	6852	},	//	28,00
		{	28500	,	6751	},	//	28,50
		{	29000	,	6651	},	//	29,00
		{	29500	,	6554	},	//	29,50
		{	30000	,	6458	},	//	30,00
		{	30500	,	6364	},	//	30,50
		{	31000	,	6271	},	//	31,00
		{	31500	,	6180	},	//	31,50
		{	32000	,	6091	},	//	32,00
		{	32500	,	6003	},	//	32,50
		{	33000	,	5917	},	//	33,00
		{	33500	,	5832	},	//	33,50
		{	34000	,	5749	},	//	34,00
		{	34500	,	5668	},	//	34,50
		{	35000	,	5587	},	//	35,00
		{	35500	,	5508	},	//	35,50
		{	36000	,	5431	},	//	36,00
		{	36500	,	5355	},	//	36,50
		{	37000	,	5280	},	//	37,00
		{	37500	,	5206	},	//	37,50
		{	38000	,	5134	},	//	38,00
		{	38500	,	5063	},	//	38,50
		{	39000	,	4993	},	//	39,00
		{	39500	,	4924	},	//	39,50
		{	40000	,	4857	},	//	40,00
		{	40500	,	4790	},	//	40,50
		{	41000	,	4725	},	//	41,00
		{	41500	,	4661	},	//	41,50
		{	42000	,	4598	},	//	42,00
		{	42500	,	4535	},	//	42,50
		{	43000	,	4474	},	//	43,00
		{	43500	,	4414	},	//	43,50
		{	44000	,	4355	},	//	44,00
		{	44500	,	4297	},	//	44,50
		{	45000	,	4240	},	//	45,00
		{	45500	,	4184	},	//	45,50
		{	46000	,	4129	},	//	46,00
		{	46500	,	4074	},	//	46,50
		{	47000	,	4021	},	//	47,00
		{	47500	,	3968	},	//	47,50
		{	48000	,	3916	},	//	48,00
		{	48500	,	3865	},	//	48,50
		{	49000	,	3815	},	//	49,00
		{	49500	,	3766	},	//	49,50
		{	50000	,	3717	},	//	50,00
		{	50500	,	3670	},	//	50,50
		{	51000	,	3623	},	//	51,00
		{	51500	,	3576	},	//	51,50
		{	52000	,	3531	},	//	52,00
		{	52500	,	3486	},	//	52,50
		{	53000	,	3442	},	//	53,00
		{	53500	,	3399	},	//	53,50
		{	54000	,	3356	},	//	54,00
		{	54500	,	3314	},	//	54,50
		{	55000	,	3272	},	//	55,00
		{	55500	,	3232	},	//	55,50
		{	56000	,	3191	},	//	56,00
		{	56500	,	3152	},	//	56,50
		{	57000	,	3113	},	//	57,00
		{	57500	,	3075	},	//	57,50
		{	58000	,	3037	},	//	58,00
		{	58500	,	3000	},	//	58,50
		{	59000	,	2963	},	//	59,00
		{	59500	,	2927	},	//	59,50
		{	60000	,	2892	},	//	60,00
		{	60500	,	2857	},	//	60,50
		{	61000	,	2822	},	//	61,00
		{	61500	,	2788	},	//	61,50
		{	62000	,	2755	},	//	62,00
		{	62500	,	2722	},	//	62,50
		{	63000	,	2689	},	//	63,00
		{	63500	,	2658	},	//	63,50
		{	64000	,	2626	},	//	64,00
		{	64500	,	2595	},	//	64,50
		{	65000	,	2564	},	//	65,00
		{	65500	,	2534	},	//	65,50
		{	66000	,	2505	},	//	66,00
		{	66500	,	2475	},	//	66,50
		{	67000	,	2447	},	//	67,00
		{	67500	,	2418	},	//	67,50
		{	68000	,	2390	},	//	68,00
		{	68500	,	2363	},	//	68,50
		{	69000	,	2336	},	//	69,00
		{	69500	,	2309	},	//	69,50
		{	70000	,	2282	},	//	70,00
		{	70500	,	2256	},	//	70,50
		{	71000	,	2231	},	//	71,00
		{	71500	,	2205	},	//	71,50
		{	72000	,	2180	},	//	72,00
		{	72500	,	2156	},	//	72,50
		{	73000	,	2132	},	//	73,00
		{	73500	,	2108	},	//	73,50
		{	74000	,	2084	},	//	74,00
		{	74500	,	2061	},	//	74,50
		{	75000	,	2038	},	//	75,00
		{	75500	,	2015	},	//	75,50
		{	76000	,	1993	},	//	76,00
		{	76500	,	1971	},	//	76,50
		{	77000	,	1950	},	//	77,00
		{	77500	,	1928	},	//	77,50
		{	78000	,	1907	},	//	78,00
		{	78500	,	1886	},	//	78,50
		{	79000	,	1866	},	//	79,00
		{	79500	,	1846	},	//	79,50
		{	80000	,	1826	},	//	80,00
		{	80500	,	1806	},	//	80,50
		{	81000	,	1787	},	//	81,00
		{	81500	,	1768	},	//	81,50
		{	82000	,	1749	},	//	82,00
		{	82500	,	1730	},	//	82,50
		{	83000	,	1712	},	//	83,00
		{	83500	,	1694	},	//	83,50
		{	84000	,	1676	},	//	84,00
		{	84500	,	1658	},	//	84,50
		{	85000	,	1641	},	//	85,00
		{	85500	,	1623	},	//	85,50
		{	86000	,	1606	},	//	86,00
		{	86500	,	1590	},	//	86,50
		{	87000	,	1573	},	//	87,00
		{	87500	,	1557	},	//	87,50
		{	88000	,	1541	},	//	88,00
		{	88500	,	1525	},	//	88,50
		{	89000	,	1509	},	//	89,00
		{	89500	,	1494	},	//	89,50
		{	90000	,	1479	},	//	90,00
		{	90500	,	1464	},	//	90,50
		{	91000	,	1449	},	//	91,00
		{	91500	,	1434	},	//	91,50
		{	92000	,	1419	},	//	92,00
		{	92500	,	1405	},	//	92,50
		{	93000	,	1391	},	//	93,00
		{	93500	,	1377	},	//	93,50
		{	94000	,	1363	},	//	94,00
		{	94500	,	1350	},	//	94,50
		{	95000	,	1336	},	//	95,00
		{	95500	,	1323	},	//	95,50
		{	96000	,	1310	},	//	96,00
		{	96500	,	1297	},	//	96,50
		{	97000	,	1284	},	//	97,00
		{	97500	,	1272	},	//	97,50
		{	98000	,	1259	},	//	98,00
		{	98500	,	1247	},	//	98,50
		{	99000	,	1235	},	//	99,00
		{	99500	,	1223	}	//	99,50
};

uint16_t numRows;

void Thermistor_InitFunction(void)
{
	u32ResistanceOfSensor = 0;
	u16VoltageOfSensor = 0;
}

void Thermistor_CalculateResistance(void)
{
	u16VoltageOfSensor = AdcCalculateVOLTAGE();
	u32ResistanceOfSensor = ((u16VoltageOfSensor* RESOLUTION_SCALE) / (((uint32_t)(VREFANALOG_VOLTAGE-u16VoltageOfSensor) * RESOLUTION_SCALE) / RESISTENCE_VALUE));

}

void Thermistor_CalculateGradeCelsius(void)
{
    for (u16IndexForARRAY = 0; u16IndexForARRAY < ROWS; u16IndexForARRAY++) {

        if((u32ResistanceOfSensor < u16TabelsOfGrades[u16IndexForARRAY + 1][1]) && (u32ResistanceOfSensor < u16TabelsOfGrades[u16IndexForARRAY - 1][1]))
		{
            u16TemperatureOnTheSensor = (u16TabelsOfGrades[u16IndexForARRAY][0]) / 1000;
		}
    }
}

void Thermistor_MainFunction(void)
{
	Thermistor_CalculateResistance();
	Thermistor_CalculateGradeCelsius();
}
